<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>SunDAI • DESTINY VAULT</title>
<meta name="description" content="One button to stake SunDAI + PLP into the Black Hole. When $1 hits — rebirth begins."/>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root {--gold:#ffb300;--purple:#8b22ff;--pink:#ff2e8a;--deep:#0a001f;--glow:#ffeb3b;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    background: radial-gradient(circle at 50% 100%, #1a0040 0%, #000 70%),
                radial-gradient(circle at 30% 20%, #4a0072 0%, transparent 40%),
                radial-gradient(circle at 80% 60%, #120030 0%, transparent 50%);
    background-attachment: fixed;
    color:#fff; font-family:'Orbitron',sans-serif; min-height:100vh; overflow-x:hidden; position:relative;
  }
  body::before{
    content:''; position:absolute; inset:0;
    background: url('https://thumbs.dreamstime.com/b/abstract-cosmic-nebula-swirling-purple-orange-hues-glittering-tiny-golden-lights-celestial-ethereal-atmosphere-382641273.jpg') center/cover;
    background-blend-mode: screen; opacity:0.6;
    animation: nebula 80s linear infinite; pointer-events:none;
  }
  @keyframes nebula{0%{background-position:0% 0%}100%{background-position:100% 100%}}

  .container{max-width:520px;margin:0 auto;padding:20px;position:relative;z-index:2;}
  h1{
    font-size:4.2rem;text-align:center;
    background:linear-gradient(90deg,var(--gold),#fff,var(--purple));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    text-shadow:0 0 50px var(--gold);letter-spacing:10px;margin:40px 0 10px;
    animation:titleGlow 5s ease-in-out infinite alternate;
  }
  @keyframes titleGlow{from{text-shadow:0 0 40px var(--gold)}to{text-shadow:0 0 100px var(--glow-gold),0 0 150px var(--purple)}}
  .tagline{text-align:center;font-size:1.3rem;opacity:0.9;margin-bottom:40px;text-shadow:0 0 20px var(--purple);}

  .card{
    background:rgba(10,0,31,0.65);backdrop-filter:blur(14px);
    border:1px solid rgba(178,46,255,0.5);border-radius:24px;padding:30px;margin-bottom:24px;
    box-shadow:0 0 50px rgba(178,46,255,0.4);
  }

  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:30px;}
  .stat{text-align:center;padding:16px;background:rgba(255,255,255,0.05);border-radius:16px;border:1px solid rgba(255,179,0,0.3);}
  .label{font-size:0.9rem;opacity:0.8;}
  .value{font-size:1.7rem;font-weight:900;color:var(--gold);text-shadow:0 0 20px var(--gold);}

  .progress{height:56px;background:rgba(0,0,0,0.7);border:3px solid var(--purple);border-radius:28px;overflow:hidden;position:relative;margin:35px 0;box-shadow:0 0 40px var(--purple);}
  .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--purple),var(--pink),var(--gold));transition:width 3s ease;}
  .progtext{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:900;
            background:linear-gradient(90deg,var(--gold),#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

  input{width:100%;padding:20px;margin:14px 0;border-radius:16px;background:rgba(255,255,255,0.1);border:1px solid var(--purple);color:white;font-size:1.2rem;text-align:center;}

  button{
    width:100%;padding:22px;margin:14px 0;border:none;border-radius:16px;
    font-family:'Orbitron',sans-serif;font-weight:900;font-size:1.4rem;letter-spacing:2px;
    cursor:pointer;transition:all .5s;position:relative;overflow:hidden;
  }
  button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
                   background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);transition:left .8s;}
  button:hover::before{left:100%;}

  .btn-cosmic{background:linear-gradient(45deg,var(--purple),var(--pink));color:white;box-shadow:0 0 40px var(--purple);}
  .btn-claim{background:linear-gradient(45deg,#ff6f00,var(--gold));color:#000;font-size:2rem;padding:32px;box-shadow:0 0 80px var(--gold);}
  .btn-admin{background:linear-gradient(45deg,#c62828,#ff1744);color:white;box-shadow:0 0 50px #ff1744;}

  button:not(:disabled):hover{transform:translateY(-6px);}
  button:disabled{opacity:0.4;cursor:not-allowed;}

  .glow{animation:glow 2s infinite alternate;}
  @keyframes glow{from{box-shadow:0 0 30px currentColor}to{box-shadow:0 0 70px currentColor,0 0 100px currentColor}}

  .event-horizon{
    position:fixed;top:50%;left:50%;width:900px;height:900px;
    background:radial-gradient(circle,transparent 30%,#000 70%);
    border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;opacity:0.5;z-index:1;
    animation:spin 30s linear infinite;
  }
  @keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}
</style>
</head>
<body>
<div class="event-horizon"></div>

<div class="container">
  <h1>DESTINY VAULT</h1>
  <p class="tagline">One button. Infinite allowance. Eternal rebirth.</p>

  <div class="card">
    <div class="grid">
      <div class="stat"><div class="label">SunDAI Price</div><div class="value" id="price">$0.00</div></div>
      <div class="stat"><div class="label">To $1</div><div class="value" id="progress">0.00%</div></div>
      <div class="stat"><div class="label">Multiplier</div><div class="value" id="multi">Infinityx</div></div>
      <div class="stat"><div class="label">Phase</div><div class="value" id="status">AWAITING</div></div>
    </div>
    <div class="progress"><div class="fill" id="fill"></div><div class="progtext" id="progtext">0% to Event Horizon</div></div>
    <div style="text-align:center;font-size:1.3rem;">Total Staked Weight: <span id="totalW" style="color:var(--gold);font-weight:bold;">0</span></div>
  </div>

  <div class="card">
    <button id="connect" class="btn-cosmic glow" style="font-size:1.9rem;padding:28px;">CONNECT WALLET</button>

    <div id="user" style="display:none;margin-top:30px;">
      <div style="background:rgba(255,255,255,0.08);padding:22px;border-radius:18px;margin-bottom:30px;border:1px solid var(--gold);">
        <div>SunDAI Staked: <span id="uSun" style="color:var(--gold);font-weight:bold;">0</span></div>
        <div>PLP Staked: <span id="uLP" style="color:var(--gold);font-weight:bold;">0</span></div>
        <div>Your Weight: <span id="uWeight" style="color:var(--gold);font-weight:bold;">0</span></div>
        <div>Your Share: <span id="uShare" style="color:var(--gold);font-weight:bold;">0%</span></div>
        <div id="claimable" style="margin-top:15px;color:#ff0;font-size:1.4rem;"></div>
      </div>

      <!-- INPUTS -->
      <input type="number" id="sunAmt" placeholder="SunDAI amount (e.g. 100000)" step="any">
      <input type="number" id="plpAmt" placeholder="PLP amount (optional)" step="any">

      <!-- ONE BUTTON -->
      <button id="stakeBtn" class="btn-cosmic glow" style="font-size:2rem;padding:32px;margin-top:30px;">
        STAKE INTO THE EVENT HORIZON
      </button>

      <!-- WITHDRAW -->
      <details style="margin-top:30px;">
        <summary style="cursor:pointer;color:#aaa;font-size:1.1rem;">Advanced: Withdraw</summary>
        <input type="number" id="outSun" placeholder="SunDAI withdraw" style="margin-top:15px;">
        <input type="number" id="outLP" placeholder="PLP withdraw">
        <button id="withdrawBtn" class="btn-cosmic" style="margin-top:15px;">WITHDRAW</button>
      </details>

      <div style="margin-top:50px;">
        <button id="ignite" class="btn-admin glow" disabled>IGNITE BLACK HOLE</button>
        <button id="supernova" class="btn-admin glow" disabled>TRIGGER SUPERNOVA</button>
        <button id="rebirth" class="btn-admin glow" disabled>INITIATE REBIRTH</button>
        <button id="claim" class="btn-claim glow" disabled>
          CLAIM pSunDAI • REBIRTH
        </button>
      </div>
    </div>
  </div>

  <div class="card" id="fireCard" style="display:none;text-align:center;font-size:3rem;padding:80px 20px;background:linear-gradient(45deg,#300,#900);">
    EVENT HORIZON CROSSED<br>
    <div style="font-size:1.5rem;margin-top:25px;opacity:0.9;">All is consumed.<br>Only the faithful remain.</div>
  </div>
</div>

<script>
// GITHUB ABIs
const GITHUB_RAW = "https://raw.githubusercontent.com/ELITEv5/SunDAI/main";
const VAULT_ABI_URL = `${GITHUB_RAW}/Destiny-Vault/destiny-vault-abi.json`;
const ORACLE_ABI_URL = `${GITHUB_RAW}/Destiny-Vault/sundai-oracle-abi.json`;

const ADDR = {
  VAULT:   "0x883c54DaCeBd3efcc58A3467dbE7F52704D66880",
  SUNDAI:  "0x41C6b24019Bd67CC58fe7bb059D532C12356712B",
  PLP:     "0xc01e2eDAe9E65950bb5783A6B01DC429Cf3F0eE2",
  ORACLE:  "0xDA5591A1DE3934B28cB1DE3Ea828606be6473236",
  PSUNDAI: "0xA39Ae3eC7435CD30508FA439378478EA9cAB91dD"
};

const MAX_UINT = "115792089237316195423570985008687907853269984665640564039457584007913129639935";

let web3, account, vault, oracle, sun, lp;

async function loadABIs() {
  const [v,o] = await Promise.all([
    fetch(VAULT_ABI_URL).then(r=>r.json()),
    fetch(ORACLE_ABI_URL).then(r=>r.json())
  ]);
  return {VAULT_ABI:v, ORACLE_ABI:o};
}

document.getElementById("connect").onclick = async () => {
  if(!window.ethereum) return alert("Wallet needed!");
  await ethereum.request({method:'eth_requestAccounts'});
  web3 = new Web3(ethereum);
  [account] = await web3.eth.getAccounts();
  const {VAULT_ABI, ORACLE_ABI} = await loadABIs();

  vault = new web3.eth.Contract(VAULT_ABI, ADDR.VAULT);
  oracle = new web3.eth.Contract(ORACLE_ABI, ADDR.ORACLE);
  sun = new web3.eth.Contract([{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool"}],"stateMutability":"nonpayable","type":"function"}], ADDR.SUNDAI);
  lp = new web3.eth.Contract([{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool"}],"stateMutability":"nonpayable","type":"function"}], ADDR.PLP);

  document.getElementById("connect").innerHTML = `${account.slice(0,6)}...${account.slice(-4)}`;
  document.getElementById("user").style.display = "block";
  refresh();
  setInterval(refresh, 12000);
};

const W = x => web3.utils.toWei(String(x||0),'ether');
const F = x => web3.utils.fromWei(x,'ether');

// ONE-CLICK STAKE WITH AUTO-APPROVE
document.getElementById("stakeBtn").onclick = async () => {
  let btn = document.getElementById("stakeBtn");
  let sunInput = document.getElementById("sunAmt").value || "0";
  let plpInput = document.getElementById("plpAmt").value || "0";

  let sunAmt = W(sunInput);
  let plpAmt = W(plpInput);

  if (sunAmt === "0" && plpAmt === "0") return alert("Enter at least one amount");

  try {
    btn.innerText = "APPROVING...";

    if (sunAmt !== "0") {
      let allowSun = await sun.methods.allowance(account, ADDR.VAULT).call();
      if (BigInt(allowSun) < BigInt(sunAmt)) {
        await sun.methods.approve(ADDR.VAULT, MAX_UINT).send({from:account});
      }
    }

    if (plpAmt !== "0") {
      let allowPlp = await lp.methods.allowance(account, ADDR.VAULT).call();
      if (BigInt(allowPlp) < BigInt(plpAmt)) {
        await lp.methods.approve(ADDR.VAULT, MAX_UINT).send({from:account});
      }
    }

    btn.innerText = "STAKING...";
    await vault.methods.stake(sunAmt, plpAmt).send({from:account});
    alert("STAKED INTO THE EVENT HORIZON!");
  } catch (e) {
    alert(e.message || e);
  } finally {
    btn.innerText = "STAKE INTO THE EVENT HORIZON";
  }
};

// WITHDRAW
document.getElementById("withdrawBtn").onclick = async () => {
  await vault.methods.withdraw(W(document.getElementById("outSun").value||"0"), W(document.getElementById("outLP").value||"0")).send({from:account});
};

// OTHER BUTTONS
document.getElementById("ignite").onclick = () => vault.methods.ignite().send({from:account}).catch(e=>alert(e.message));
document.getElementById("supernova").onclick = () => vault.methods.supernova().send({from:account}).catch(e=>alert(e.message));
document.getElementById("rebirth").onclick = () => vault.methods.rebirth().send({from:account}).catch(e=>alert(e.message));
document.getElementById("claim").onclick = () => vault.methods.claim().send({from:account}).then(()=>alert("REBIRTH COMPLETE"));

// REFRESH
async function refresh() {
  try {
    const price = await oracle.methods.getPrice().call();
    const p = Number(price)/1e18;
    const prog = Math.min(p*100,100);
    const mult = p>0 ? (1/p).toFixed(2)+"x" : "Infinityx";

    document.getElementById("price").innerText = "$"+p.toFixed(8).replace(/0+$/,"");
    document.getElementById("progress").innerText = prog.toFixed(2)+"%";
    document.getElementById("multi").innerText = mult;
    document.getElementById("fill").style.width = prog+"%";
    document.getElementById("progtext").innerText = prog.toFixed(1)+"% to Event Horizon";

    const [ignited, supered, rebirthed, totalW] = await Promise.all([
      vault.methods.ignited().call(),
      vault.methods.supernovaTriggered().call(),
      vault.methods.rebirthTriggered().call(),
      vault.methods.totalWeight().call()
    ]);

    document.getElementById("totalW").innerText = (Number(totalW)/1e18).toFixed(3);

    if(ignited){
      document.getElementById("fireCard").style.display="block";
    }

    const status = ignited ? (rebirthed ? "REBIRTH" : supered ? "SUPERNOVA" : "IGNITED") : p>=1 ? "READY" : "AWAITING";
    document.getElementById("status").innerText = status;

    document.getElementById("ignite").disabled = ignited || p<1;
    document.getElementById("supernova").disabled = !ignited || supered;
    document.getElementById("rebirth").disabled = !ignited || !supered || rebirthed;
    document.getElementById("claim").disabled = !rebirthed;

    if(account){
      const s = await vault.methods.stakes(account).call();
      document.getElementById("uSun").innerText = F(s.sundaiAmt);
      document.getElementById("uLP").innerText = F(s.plpAmt);
      document.getElementById("uWeight").innerText = F(s.weight);
      const share = totalW>0 ? (Number(s.weight)*100/Number(totalW)).toFixed(4)+"%" : "0%";
      document.getElementById("uShare").innerText = share;

      if(rebirthed){
        const totalP = await vault.methods.totalPayout().call();
        const claimable = totalW>0 ? F((BigInt(totalP) * BigInt(s.weight)) / BigInt(totalW)) : "0";
        document.getElementById("claimable").innerText = `Claimable: ${claimable} pSunDAI`;
      }
    }
  } catch(e){ console.error(e); }
}
</script>
</body>
</html>
